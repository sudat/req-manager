import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY! || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

if (!supabaseUrl || !supabaseKey) {
  console.error('Supabase credentials not found');
  process.exit(1);
}

const supabase = createClient(supabaseUrl, supabaseKey);

const updates: Record<string, string> = {
  'SRF-001': `## 概要

適格請求書等保存方式に対応した請求書PDFを生成する機能

### 主な機能
- PuppeteerとHandlebars.jsによるHTMLテンプレートからのPDF生成
- 税率別（10%/8%）の対価額と税額の集計・表示
- 登録番号（T+13桁）を含むインボイス対応帳票出力

### 対象
経理担当者、営業担当者（請求書作成者）

### 関連
- 関連タスク：TASK-003
- 関連要件：SR-TASK-003-001, SR-TASK-003-002`,

  'SRF-002': `## 概要

請求明細から税率別の対価と税額を集計し、帳票出力APIへ提供する機能

### 主な機能
- 商品マスタの税率区分に基づく軽減税率（8%）と標準税率（10%）の判定・計算
- 税率別集計結果のキャッシュによる再集計負荷軽減
- 端数処理ルール（切り捨て/四捨五入/切り上げ）の設定

### 対象
経理担当者、税務担当者

### 関連
- 関連タスク：TASK-003
- 関連要件：SR-TASK-003-003`,

  'SRF-003': `## 概要

銀行からダウンロードした全銀フォーマットファイルを解析し、入金データをデータベースへ登録する機能

### 主な機能
- 全銀協フォーマット（固定長テキスト）のパース処理
- FTPサーバーからの銀行ファイル自動ダウンロードと取り込みバッチ処理
- フォーマットエラー、文字化け等のエラーハンドリングと再実行機能

### 対象
経理担当者、システム管理者

### 関連
- 関連タスク：TASK-004
- 関連要件：SR-TASK-004-001`,

  'SRF-004': `## 概要

取り込んだ入金データと請求データを突合し、自動・手動で消込処理を行う機能

### 主な機能
- 顧客コード、金額、入金日をキーとした自動消込アルゴリズム
- 自動消込できなかった入金の手動紐付け（ドラッグ＆ドロップ対応）
- 1回の入金で複数請求を消込、または複数回の入金で1請求を消込する部分消込対応

### 対象
経理担当者、回収担当者

### 関連
- 関連タスク：TASK-004
- 関連要件：SR-TASK-004-002`,

  'SRF-005': `## 概要

未回収債権を一覧表示し、督促状況や回収計画を確認できる画面

### 主な機能
- 顧客別、期日別、金額順でのソート・フィルタ機能
- 経過日数に応じた色分け表示（30日以内：青、60日以内：黄、60日超：赤）
- 債権一覧のExcel/CSV形式エクスポート

### 対象
経理担当者、回収担当者、営業マネージャー

### 関連
- 関連タスク：TASK-005
- 関連要件：SR-TASK-005-001, SR-TASK-005-002`,

  'SRF-006': `## 概要

顧客別の与信枠を管理し、限度超過時のアラートを行う画面

### 主な機能
- 顧客別の与信枠、使用枠、残枠の一覧表示と超過顧客のハイライト
- 売掛計上時の与信枠チェックと超過時のアラート通知（受注阻止オプション付き）
- 与信枠変更履歴の記録と監査証跡

### 対象
営業担当者、与信管理者、経理担当者

### 関連
- 関連タスク：TASK-001
- 関連要件：SR-TASK-001-001`,

  'SRF-007': `## 概要

生成された請求書PDFを顧客ポータルへ送信するインターフェース機能

### 主な機能
- 顧客ポータルとのAPI連携（OAuth 2.0認証）による請求書PDF送信
- 送信キューマネージャーによるリトライ機能とデッドレターキュー管理
- 送信結果の記録と失効分の再送機能

### 対象
経理担当者、システム管理者

### 関連
- 関連タスク：TASK-003
- 関連要件：SR-TASK-003-004`,

  'SRF-008': `## 概要

延滞債権を検知し、関係者へ通知する機能

### 主な機能
- 日次バッチによる延滞債権の自動検出（基準日：支払期日+60日）
- 延滞債権情報を含むメール通知（回収担当者宛）
- 通知履歴の記録による二重通知防止

### 対象
回収担当者、経理担当者

### 関連
- 関連タスク：TASK-006, TASK-005
- 関連要件：SR-TASK-006-001`,

  'SRF-009': `## 概要

支払対象の仕入請求書を選択し、金額確認の上で承認依頼を行う画面

### 主な機能
- 仕入請求書の一覧表示とチェックボックスによる支払対象選択
- 支払対象の合計金額と買掛残高の照合・バリデーション
- 承認依頼作成時の承認者へのメール通知

### 対象
経理担当者、仕入担当者

### 関連
- 関連タスク：TASK-009
- 関連要件：SR-TASK-009-001`,

  'SRF-010': `## 概要

支払依頼の一覧表示、承認・却下を行う画面

### 主な機能
- 承認待ち支払依頼の詳細表示（仕入請求書画像、支払金額含む）
- 支払金額に応じた承認権限管理（50万以上：部長承認、100万以上：本部長承認等）
- 承認/却下結果の依頼者へのメール通知

### 対象
承認権限者（部長、本部長等）

### 関連
- 関連タスク：TASK-010
- 関連要件：SR-TASK-010-001`,

  'SRF-011': `## 概要

承認済みの支払データを銀行IFへ送信し、支払を実行する機能

### 主な機能
- 全銀フォーマットによる支払データ作成と銀行への送信
- 承認済み支払依頼の抽出と銀行IF連携の定時実行バッチ
- 銀行IFエラー時の再送キュー登録（最大3回リトライ）

### 対象
経理担当者、システム管理者

### 関連
- 関連タスク：TASK-011
- 関連要件：SR-TASK-011-001`,

  'SRF-012': `## 概要

支払手形の発行、期日管理、支払処理を行う画面

### 主な機能
- 支払手形の一覧表示（期日順、金額順でソート）
- 手形の期日管理と期日到来時の通知
- 期日到来手形の抽出と銀行IF連携による支払実行バッチ

### 対象
経理担当者、財務担当者

### 関連
- 関連タスク：TASK-012
- 関連要件：SR-TASK-012-001, SR-TASK-012-002`,

  'SRF-013': `## 概要

仕入先から受け取った請求書データを取り込み、買掛金へ計上する機能

### 主な機能
- OCR連携による請求書スキャン画像からの文字抽出・自動データ作成（オプション）
- 請求内容の手動入力画面（仕入先、請求番号、金額、消費税）
- 必須項目チェック、金額整合性チェック、仕入先マスタ存在チェック

### 対象
経理担当者、仕入担当者

### 関連
- 関連タスク：TASK-007
- 関連要件：SR-TASK-007-001`,

  'SRF-014': `## 概要

仕入先別の買掛残高を表示し、支払計画を策定する画面

### 主な機能
- 仕入先別の買掛残高一覧表示（支払予定日、金額、残高）
- 買掛残高と支払条件に基づく支払計画の立案
- 仕入先ごとの支払実績・支払傾向分析ダッシュボード

### 対象
経理担当者、財務担当者

### 関連
- 関連タスク：TASK-014
- 関連要件：SR-TASK-014-001`,

  'SRF-015': `## 概要

仕入先ポータルと連携し、請求書データを取得するインターフェース機能

### 主な機能
- 仕入先ポータルとのAPI連携（API KeyまたはOAuth認証）
- 定期的な請求書データの取得と自社システムとの同期バッチ
- APIエラー、データ不整合等の検知と管理者通知

### 対象
経理担当者、システム管理者

### 関連
- 関連タスク：TASK-013
- 関連要件：SR-TASK-013-002, SR-TASK-013-003`,

  'SRF-016': `## 概要

買掛データから支払予定を自動作成する機能

### 主な機能
- 買掛データと支払条件（締日、支払日）に基づく支払予定日計算
- 月次バッチによる翌月支払予定の自動作成
- 自動作成された支払予定の手動調整（支払日変更、金額分割）

### 対象
経理担当者、財務担当者

### 関連
- 関連タスク：TASK-013
- 関連要件：SR-TASK-013-001`,

  'SRF-017': `## 概要

手動で仕訳データを入力し、仕訳帳へ登録する機能

### 主な機能
- 日付、借方勘定科目、貸方勘定科目、金額、摘要の入力フォーム
- ツリービューまたはオートコンプリートによる勘定科目選択
- 借方合計と貸方合計のバリデーション（不一致の場合はエラー）
- 頻繁に使用する仕訳パターンのテンプレート保存と再利用

### 対象
経理担当者、会計担当者

### 関連
- 関連タスク：TASK-015
- 関連要件：SR-TASK-015-001`,

  'SRF-018': `## 概要

各業務プロセスから自動生成される仕訳を転記する機能

### 主な機能
- 売上、買掛、決算等の各業務プロセスからの仕訳データ自動生成
- 業務イベントと仕訳パターンを紐づけるルールテーブル管理
- 生成された仕訳データの仕訳帳テーブルへの転記バッチ処理

### 対象
経理担当者、システム管理者

### 関連
- 関連タスク：TASK-016
- 関連要件：SR-TASK-016-001`,

  'SRF-019': `## 概要

勘定科目別の取引明細を表示する画面

### 主な機能
- 勘定科目選択と期間指定（会計期間、月次、日次）による取引明細表示
- 借方合計、貸方合計、残高の表示と仕訳詳細へのドリルダウン
- 総勘定元帳のPDF形式出力（監査、税務申告対応）

### 対象
経理担当者、会計監査人、税理士

### 関連
- 関連タスク：TASK-017
- 関連要件：SR-TASK-017-001`,

  'SRF-020': `## 概要

試算表を表示し、貸借整合を確認する画面

### 主な機能
- 総勘定元帳から勘定科目別の借方合計、貸方合計を集計
- 全勘定科目の借方合計と貸方合計の整合チェック
- 前期比、前月比による金額比較と増減率表示
- 試算表のExcel形式出力（経営分析活用）

### 対象
経理担当者、財務担当者、経営企画

### 関連
- 関連タスク：TASK-018
- 関連要件：SR-TASK-018-001`,

  'SRF-021': `## 概要

貸借対照表（B/S）、損益計算書（P/L）を表示し、Excel出力を行う画面

### 主な機能
- 試算表データからのB/S、P/L生成（勘定科目の配賦ルール適用）
- セグメント別表示の可能な財務諸表表示
- 財務諸表のExcel形式出力（株主総会、銀行提出対応）

### 対象
経理担当者、財務担当者、経営層

### 関連
- 関連タスク：TASK-019
- 関連要件：SR-TASK-019-001`,

  'SRF-022': `## 概要

決算時に必要な整理仕訳を自動計上する機能

### 主な機能
- 減価償却、賞与引当等の決算整理仕訳ルール定義
- 固定資産マスタからの償却費計算と仕訳データ自動生成
- 決算整理仕訳転記後の試算表締め処理
- 次期への繰越残高計算と期首残高設定

### 対象
経理担当者、会計担当者

### 関連
- 関連タスク：TASK-020
- 関連要件：SR-TASK-020-001, SR-TASK-020-002, SR-TASK-020-003`,

  'SRF-023': `## 概要

固定資産の償却費を自動計算する機能

### 主な機能
- 固定資産マスタ管理（資産名、取得価額、耐用年数、償却方法）
- 定額法、定率法による償却費計算（取得日、償却開始日考慮）
- 各固定資産の償却スケジュール（耐用年数分）作成
- 月次バッチによる償却費計算と仕訳データ自動生成

### 対象
経理担当者、会計担当者

### 関連
- 関連タスク：TASK-021
- 関連要件：SR-TASK-021-001`,

  'SRF-024': `## 概要

消費税、法人税の申告データを作成する画面

### 主な機能
- 総勘定元帳からの課税売上、免税売上、課税仕入集計による消費税申告データ作成
- 損益計算書からの所得金額計算による法人税申告データ作成
- 消費税、法人税申告データの表示・修正・調整
- 税務申告書のPDF形式出力（e-Tax連携準備）

### 対象
経理担当者、税務担当者、税理士

### 関連
- 関連タスク：TASK-022
- 関連要件：SR-TASK-022-001, SR-TASK-022-002`,
};

async function main() {
  console.log('Starting update...');

  for (const [id, summary] of Object.entries(updates)) {
    console.log(`Updating ${id}...`);
    const { error } = await supabase
      .from('system_functions')
      .update({ summary })
      .eq('id', id);

    if (error) {
      console.error(`Failed to update ${id}:`, error);
    } else {
      console.log(`Updated ${id} successfully`);
    }
  }

  console.log('Update complete!');
}

main().catch(console.error);
