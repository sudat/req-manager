# LLM支援型要件管理ツール 要件定義書 v1.2

## 1. 目的と設計思想

### 1.1 解決する課題

ERP級の大規模システムでは、要件間のリンク（トレーサビリティ）を人手で張ると維持コストで運用が崩壊する。かといってLLMに全自動でリンク生成を任せると、業務コンテキストを踏まえた判断ができず誤りが生じる。

本ツールは「LLMに候補生成と根拠の整形までやらせて、最終決定は人間がレビューで握る」という分業を実現する。

### 1.2 2つの管理対象

本ツールは2つの異なる関心事を分離して管理する。

| 区分 | ベースライン仕様 | 変更要求 |
|------|------------------|----------|
| 性質 | 状態（現行仕様の体系） | イベント（仕様変更のチケット） |
| 問いへの回答 | 「請求業務ってどんな仕様？」 | 「インボイス対応で何を変える？」 |
| 構造 | 業務（分類）→ 業務タスク → 業務要件 → システム要件 | 変更要求 → 影響要件 → 変更内容 |
| 版管理 | ベースラインは版（スナップショット）を持つ | 変更要求↔版は多対多。同一変更の複数版への適用を追跡可能 |

### 1.2.1 正本（Single Source of Truth）

本ツールは「要件の正本」とする。外部ツール（Confluence/Notion/リポジトリ等）は参照先として扱い、リンクや抜粋を保持するが、正本は本ツール側に置く。

### 1.2.2 管理対象の範囲（LLMが読む範囲）

- Must: 業務タスク / 業務要件 / システム要件（根拠を含む）
- Must: 設計書（少なくとも要点の本文、または参照リンク＋抜粋を保持）
- Want: ソースコード（GitHub連携前提。リンクやパス情報は保持するが、分析対象は任意）

### 1.3 概念辞書は「育てる」

概念辞書（用語の同義語、影響領域、必読ドキュメントを定義）を人間が最初に作る運用は採用しない。要件入力のたびにLLMが概念候補を抽出し、ユーザーが承認・修正・却下することで、概念辞書が副産物として育つ設計とする。

運用中に発生する重複・衝突・陳腐化に対応するため、概念の統合・分割・廃止機能を備える。

### 1.4 LLMと人間の役割

| 担当 | 役割 |
|------|------|
| LLM | 候補生成（業務、概念、影響領域、関連要件、受入条件）、根拠整形、既存データへの差分として提示 |
| 人間 | ラフ入力（音声可）、候補の承認・修正・却下、最終判断 |

### 1.5 根拠提示の要件

LLMが候補を提示する際、根拠は以下を満たすこと。レビューを形骸化させないための必須要件である。

- どの既存要件のどの記述にヒットしたかを明示
- どの概念辞書エントリにマッチしたかを明示
- なぜ複数領域（例：SDだけでなくFIも）に影響するかを説明
- 根拠からクリックで原文（要件詳細、概念辞書エントリ）へ遷移可能
- 根拠は構造化データとしてエクスポート可能（4.4参照）

### 1.6 suspect link（要再確認リンク）の要件

要件が更新された場合、関連リンクに「要再確認」フラグを付与する。ただし、フラグが多すぎると誰も見なくなるため、以下の制御を行う。

- リンクごとに「最終確認時点」を保持
- 変更の重大度を段階化（高/中/低）し、軽微な変更ではsuspectにしない、または低優先度にする
- ダッシュボードで重大度別の要再確認リンク数を表示
- 一括確認UIで効率的に消化可能

### 1.7 スコープ外

テスト管理ツールとの連携（テストケース管理、テスト実行結果の追跡）は本ツールのスコープ外とする。受入条件のlintは本ツールで行うが、テストケースへの変換・管理は別ツールの責務とする。

---

## 2. 画面構成

### 2.1 サイドメニュー

全画面で共通のサイドメニューを使用する（設定画面も同一のメニュー構成とスタイル）。
モックでは共通パーツとしてサイドバーを一元化し、各画面から読み込む。
トップバーの通知ベル・ユーザーアイコンは表示しない（ダッシュボードと同一仕様）。
設定画面は上部に「設定」タイトルと説明文を配置し、下段で左に小メニュー、右に各設定内容を配置する。
一覧系の検索入力と追加系ボタンは変更要求一覧のツールバーデザインに統一する。
設定画面の右側メインエリアは「プロジェクト設定」と同じカードレイアウトに統一する。
サイドメニューは主要導線（ベースライン/変更要求/照会）と管理導線に分け、概念辞書は管理セクションに配置する。
概念辞書は単独作業の入口ではなく、レビューや照会からの導線で使用される前提とする。

### 2.1.1 モックUI方針（Tailwind CSS）

- `mock/output` 配下のモックは Tailwind CSS（CDN）で統一する
- ブランドカラーは #00897b を基準に `brand` として定義し、ボタン/バッジ/アクセントに使用する
- 画面間で同一のコンポーネント（ボタン、カード、テーブル、入力）は共通スタイルに揃える
- ダッシュボードは他画面と同一のコンポーネント/カラーに合わせ、差異を最小化する

| メニュー | 説明 |
|----------|------|
| ダッシュボード | サマリー表示、クイックアクション |
| 照会（自然言語検索） | 自然文で質問し、関連要素をランキング表示 |
| 業務一覧 | 業務体系の管理（ベースライン仕様） |
| 変更要求一覧 | 変更チケットの管理 |
| ベースライン履歴 | 版の一覧、各版に取り込んだ変更要求の確認 |
| グラフビュー | 業務・要件・概念の関係を可視化 |
| エクスポート | Claude Code連携用ファイル出力 |
| 概念辞書 | 管理セクションに配置。レビュー・照会からの導線を主とする |
| 設定 | プロジェクト設定、マスタ管理 |

### 2.2 照会画面（自然言語検索）

「インボイス対応でどこが巻き込まれるか」に直接答える画面。探索コスト削減の中核。

- 入力：自然文での質問（テキスト/音声）
- 出力：関連する業務（分類）・業務タスク・業務要件・システム要件・概念・変更要求をランキング表示
- 各結果に「なぜ関連するか」の根拠を添付（クリックで原文へ遷移）
- 結果から業務タスク詳細、要件詳細、変更要求詳細へ直接遷移可能

### 2.3 ダッシュボード画面

- 上部：ベースライン（版）情報（現在参照中の版番号・作成日時）
- 上部：サマリー（横1行：オープン変更要求数＋次回リリースまでの日数の補助表示／要再確認リンク（重大度：高/中のみ）／クイックアクション）
- 下部：レビュー待ち変更要求（優先順：リリース日が近い順→重大度）、業務領域別要件分布グラフ
- 下部：クイックアクション（照会、ベースライン参照、変更要求起票）

### 2.4 業務一覧画面

- 上部：「AI修正指示」ボタン、「手動追加」ボタン、検索
- 中央：業務テーブル（ID、業務名、領域、業務要件数、システム要件数）
- 操作：照会→業務タスク一覧（業務一覧（詳細））、修正→業務タスク一覧（更新）、削除→確認後削除

### 2.5 AI修正指示ページ（業務一覧用）

- 上部：テキスト入力（音声可）、送信ボタン
- 下部：差分候補テーブル（操作種別、業務名、根拠、採否チェック）、確定ボタン

### 2.6 業務詳細画面

本ツールの実体は「業務タスク」であり、業務（BIZ）は分類（領域）として扱う。

#### 2.6.1 業務タスク一覧（業務一覧（詳細））

「請求業務の中の業務タスクは何か？」に答える画面。

- 表示：業務ID（分類）に紐づく業務タスクの一覧
- 操作：照会→業務タスク詳細、修正→業務タスク編集、削除→確認後削除、追加→手動追加

#### 2.6.2 業務タスク詳細画面

「請求書発行ってどんな仕様？」に答える画面（要件の正本としての入口）。

- セクション1：業務タスク基本情報（業務ID、業務タスクID、業務タスク名、概要、担当者、インプット、アウトプット）
- セクション2：業務要件エリア（カード形式、AI修正指示・手動追加ボタン）
- セクション3：システム要件エリア（カード形式、紐づく業務要件・影響領域表示、要再確認フラグ付きは重大度別に強調表示）
- セクション4：設計書エリア（根拠データ。本文または参照リンク＋抜粋を保持）
- セクション5：実装参照（任意。GitHub URL、パス、メモ）
- セクション6：関連概念エリア（チップ形式）
- セクション7：変更履歴（この業務タスクに影響した変更要求、適用先の版を表示）

### 2.7 AI修正指示ページ（要件用）

ラフ入力→概念抽出→要件構造化の流れ。

- 入力エリア：テキスト入力（音声可）、送信
- 概念候補エリア：差分表示（追加/修正/削除）、根拠リンク付き、採否チェック
- 要件候補エリア：差分表示（影響領域、受入条件含む）、根拠リンク付き、採否チェック

### 2.8 変更要求一覧画面

- 上部：「変更要求を起票」ボタン、フィルタ（ステータス、影響業務、影響領域、適用先版）
- 中央：変更要求テーブル（ID、タイトル、影響業務、影響領域、ステータス、適用先版、起票日）

### 2.9 変更要求詳細画面

- セクション1：基本情報（ID、タイトル、背景・目的、ステータス）
- セクション2：影響範囲（影響業務、影響領域、影響要件）、根拠リンク付き、「AI影響分析」ボタン
- セクション3：変更内容（要件ごとに現行→変更後、受入条件）、「AI変更内容生成」ボタン
- セクション4：関連概念
- セクション5：レビュー・承認（コメント、承認/差し戻し/却下）
- セクション6：版適用履歴（どの版に適用済か、適用日時、適用状態を一覧表示）
- フッター：「ベースラインに反映」ボタン（承認済のみ活性、反映先の版を選択、複数版への適用可）

### 2.10 ベースライン履歴画面

- 版の一覧（版番号、作成日時、取り込んだ変更要求数）
- 各版の行から詳細確認へ遷移（「詳細を見る」）
- 版を選択すると、その版に取り込まれた変更要求一覧を表示
- 版間の差分表示（追加/修正/削除された要件）
- 新規版の作成（現在のベースラインを新版として確定）

### 2.11 概念辞書画面

概念の参照とメンテナンス。

- 一覧表示：概念ID、名前、同義語、影響領域、使用要件数
- 詳細表示：使用している要件一覧、必読ドキュメント
- 統合：複数の概念を1つにまとめる（使用箇所の参照も自動更新）
- 分割：1つの概念を複数に分ける（どの要件にどちらを紐づけるか選択）
- 廃止：概念を廃止（使用要件がある場合は警告、代替概念を指定）

### 2.12 グラフビュー画面

- ベースライン構造モード：業務（分類）→業務タスク→業務要件→システム要件の階層
- 変更影響モード：変更要求→影響要件の関係

### 2.13 エクスポート画面

出力形式選択、出力範囲指定（版指定可能）、プレビュー、ダウンロード。

---

## 3. 機能一覧

| 画面 | 機能 | 説明 |
|------|------|------|
| 照会 | 自然言語検索 | 自然文で質問→関連要素をランキング表示、根拠付き |
| ダッシュボード | サマリー表示 | ベースライン（版）情報、オープン変更要求数（次回リリースまで日数を補助表示）、要再確認リンク数（重大度：高/中のみ）、業務領域別要件分布、レビュー待ち変更要求（優先順）、クイックアクション |
| 業務一覧 | 一覧表示 | 業務のテーブル表示、検索 |
| | AI修正指示 | ラフ入力→LLM差分候補（根拠付き）→ユーザー確定 |
| | CRUD | 照会/修正/削除/手動追加 |
| 業務詳細 | モード切替 | 照会/更新/新規 |
| | 要件管理 | （業務タスク中心）業務要件・システム要件のCRUD、AI修正指示 |
| | 関連概念 | 概念タグの参照・編集導線 |
| | 要再確認表示 | suspect linkのフラグを重大度別に強調表示 |
| AI修正指示 | 概念抽出 | 入力文から概念候補を抽出、根拠リンク付き差分表示 |
| | 要件構造化 | 影響領域/関連要件/受入条件を候補生成、根拠リンク付き |
| 変更要求一覧 | 一覧表示 | テーブル表示、フィルタ（適用先版でフィルタ可） |
| 変更要求詳細 | AI影響分析 | 影響業務・影響要件を候補提示、根拠リンク付き |
| | 関連概念レビュー | 概念候補の承認/修正/却下、概念辞書へ遷移 |
| | ベースライン反映 | 承認済変更を指定版に反映（複数版への適用可） |
| | 版適用履歴 | どの版に適用済か、適用日時、適用状態を表示 |
| ベースライン履歴 | 版一覧 | 版番号、作成日時、取り込んだ変更要求一覧 |
| | 版間差分 | 版間で追加/修正/削除された要件を表示 |
| | 新規版作成 | 現在のベースラインを新版として確定 |
| 概念辞書 | 参照 | 概念一覧、使用要件確認 |
| | 統合 | 複数概念を1つにまとめる |
| | 分割 | 1概念を複数に分ける |
| | 廃止 | 概念を廃止（代替概念指定） |
| グラフビュー | 可視化 | 業務-要件-概念のグラフ表示 |
| エクスポート | ファイル出力 | Claude Code連携用形式で出力（版指定可、根拠データ含む） |
| 共通 | 受入条件lint | 曖昧表現検知、検証可能性チェック、警告表示 |
| | suspect link管理 | 要件更新時に重大度判定→フラグ付与、一括確認UI |

---

## 4. エクスポート仕様（Claude Code連携）

### 4.1 出力ファイル構成

```
docs/requirements/
  INDEX.md                 - ルーティング表
  concept-dictionary.yml   - 概念辞書
  requirements.graph.json  - グラフデータ（根拠データ含む）
  domains/{領域}/{業務タスク}.md - 要件ファイル群（業務タスク単位）
  design/{業務タスクID}/{設計書ID}.md - 設計書（根拠データ、必要に応じて）
  cross-cutting/{横断要件}.md
  VERSION.md               - エクスポート時点の版情報
```

### 4.2 要件ファイルフォーマット

```yaml
---
id: SR-BIL-002
title: 請求書帳票出力
task_id: TASK-001
business_req: BR-BIL-001
concepts: [TAX_INVOICE_JP, SD_BIL_FORM]
impacts: [SD_BILLING]
related: [SR-BIL-001, SR-FI-003]
---
## 概要
## 受入条件
```

### 4.3 概念辞書フォーマット

```yaml
TAX_INVOICE_JP:
  name: 適格請求書
  synonyms: [インボイス, 登録番号, 税率ごとの対価]
  impacts: [SD_BILLING, FI_TAX, FI_GL]
  must_read: [domains/sd/billing.md, domains/fi/tax_posting.md]
```

### 4.4 根拠データフォーマット（requirements.graph.json内）

リンクごとに根拠（evidence）を構造化して出力する。後から再検証・外部ツール連携が可能。

```json
"links": [
  {
    "source": "SR-BIL-002",
    "target": "SR-FI-003",
    "evidence": {
      "matched_concepts": ["TAX_INVOICE_JP"],
      "source_field": "summary",
      "source_span": "消費税調整仕訳",
      "reason": "SD請求でインボイス対応するとFI税務仕訳にも影響"
    },
    "last_confirmed": "2025-01-04T12:00:00Z",
    "suspect": false,
    "suspect_severity": null
  }
]
```

### 4.5 Claude Code Skill連携

Claude Codeの.claude/skills/にSKILL.mdを配置し、「まずINDEX.mdを読み、概念辞書でヒットしたmust_readを読む」手順を提案する。Skillは起動時に適用提案→ユーザー確認→ロードという挙動のため、完全な強制ではなく適用を促す形となる。

SKILL.mdはprogressive disclosureに従い軽量に保ち（目安500行以下）、詳細手順は別ファイルに分離する。
