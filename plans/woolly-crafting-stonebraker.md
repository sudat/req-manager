# Phase 5.7 実装後のドキュメント更新調査

## 背景

Phase 5.7（影響範囲選択・確定UI）の実装が完了したため、関連ドキュメントの更新が必要な箇所を調査する。

**完了した実装内容:**
- 5.7.1: 影響範囲選択UI（impact-scope-selector.tsx）
- 5.7.2: 影響範囲確定UI（詳細ページ）
- 5.7.3: 北極星KPI達成状況表示（一覧ページ）
- 作成ページ・編集ページへの統合

---

## 調査対象

1. **PRD (docs/prd.md)**
   - 変更要求機能の仕様記載との整合性
   - UI/UX仕様の更新

2. **チェックリスト (docs/checklists/active/2026-01-20-change-request-feature.md)**
   - 完了項目のチェック
   - 進捗サマリーの更新

3. **その他ドキュメント**
   - 設計関連ドキュメント
   - README等の説明文書

---

## 調査結果

### 1. PRD.md 更新が必要な箇所

| セクション | 行番号 | 更新内容 |
|-----------|--------|----------|
| 4.2.0 抜本方針 | 1039 | 影響範囲の実装状況を「Phase 5.7予定」→「**実装済**」に変更 |
| 4.2.1 変更要求 | 1046 | 注釈の日付を2026-01-21に更新、Phase 5.7完了を追記 |
| 4.2.1 変更要求 | 1055 | 影響範囲選択の実装状況を「未実装」→「**実装済**」に変更、備考に詳細を追加 |
| 4.2.1 変更要求 | 1055以降 | 影響範囲の確定行を新規追加 |
| 4.2.1 データアクセス層 | 1059〜1068 | 確定処理(confirmImpactScope)の詳細を追記 |
| 4.2.1 UIコンポーネント | 1069〜1077 | impact-scope-selector.tsx・ticket-impact-card.tsxを追加 |
| 3.2.2 フェーズ2 | 951〜960 | 注釈の日付を更新、フェーズFの記述を「実装済」に変更 |

### 2. チェックリスト更新が必要な箇所

| 箇所 | 行番号 | 更新内容 |
|------|--------|----------|
| Phase 5.7 実装項目 | 484-515 | 全チェックボックスを `[ ]` → `[x]` に更新 |
| 進捗サマリー（完了済み） | 566行目の次 | Phase 5.7完了を追加 |
| 進捗サマリー（次のステップ） | 570 | Phase 5.7を削除 |
| 完了基準 | 543 | 北極星KPIの判定を「実装待み」から完了状態に変更 |

---

## 実装計画

### ステップ1: PRD.md の更新

1. セクション4.2.0の抜本方針テーブルで影響範囲の実装状況を更新
2. セクション4.2.1の注釈を更新（日付と完了内容）
3. 変更要求機能テーブルに影響範囲の確定行を追加
4. データアクセス層の記述に確定機能を追記
5. UIコンポーネント一覧にimpact-scope-selector.tsxとticket-impact-card.tsxを追加
6. セクション3.2.2のフェーズF記述を更新

### ステップ2: チェックリストの更新

1. Phase 5.7の全実装項目を完了状態にする
2. 進捗サマリーにPhase 5.7完了を追加
3. 次のステップからPhase 5.7を削除
4. 完了基準を更新

---

## 更新内容の詳細

### PRD.md 更新内容（具体例）

**影響範囲の確定行を追加:**
```markdown
| 影響範囲の確定 | `/tickets/{id}` | Supabase | **実装済** | 確定ボタンで影響範囲をconfirmed状態に変更。confirmed_by/confirmed_atを記録。TicketImpactCardコンポーネントで個別確定・一括確定が可能 |
```

**UIコンポーネントに追加:**
```markdown
| `components/tickets/impact-scope-selector.tsx` | 影響範囲選択UI（業務要件・システム要件の階層選択、タブ切り替え、選択済み表示） |
| `components/tickets/ticket-impact-card.tsx` | 影響範囲確定UI（確定ボタン、confirmed状態表示、confirmed_by/confirmed_at表示、一括確定） |
```

### チェックリスト更新内容（具体例）

**Phase 5.7の完了状態:**
- [x] 業務要件選択UI（階層選択: ビジネス領域→業務タスク→業務要件）
- [x] システム要件選択UI（階層選択: システム領域→システム機能→システム要件）
- [x] 選択時の `change_request_impact_scopes` への保存
- [x] 選択要件の受入条件を `change_request_acceptance_confirmations` へ自動登録
- [x] 影響範囲の確定ボタン
- [x] confirmed_by, confirmed_at の記録
- [x] 確定済みは編集不可にする
- [x] 確認済み率の計算・表示
- [x] 北極星KPI達成フラグの表示

---

## 検証方法

更新後、以下を確認してドキュメントの整合性を検証します：

1. **PRD.md**
   - 各セクションの日付が正しく更新されているか（2026-01-21）
   - 実装状況が「実装済」に正しく変更されているか
   - 追加行がテーブルのフォーマットに合っているか

2. **チェックリスト**
   - Phase 5.7の全チェックボックスが `[x]` になっているか
   - 進捗サマリーにPhase 5.7が追加されているか
   - 「次のステップ」からPhase 5.7が削除されているか

3. **ビルド確認**
   - `bun run build` が成功することを確認（ドキュメント更新に伴うエラーがないか）

---

